package malware_gotchi;
		
import java.util.Scanner;
import java.util.Random;

public class Pet {

    public String name;
    private double happy;
    private double happinessChange;
    public int batteries = 0;
    public int timesFed;
    private int growthStage;
    
    FileHandler file;
    Boolean exit = false;

    Pet(String save, Scanner sc, ASCIISprites sprite){
	    	this.file = new FileHandler(save, sc, sprite);
	    	this.batteries = file.getBatteries();
	    	this.happinessChange = file.getHappinessChange();
	    	this.name = file.getName();
	    	this.timesFed = file.getTimesFed();
	    	this.growthStage = Math.floorDiv(this.timesFed, 15);
    }

    public void feed(){
	    if (this.batteries >= 5){
	        this.batteries -= 5;
	        System.out.println("You used 5 batteries and charged " + this.name + "! Go you!" + '\n');
	        file.setBatteries(batteries);
	        file.setLastFed(System.currentTimeMillis());
	        this.timesFed += 1;
	        file.setTimesFed(this.timesFed);
	        this.waiting();
	        
	        
	        Random rand = new Random();
	        if (rand.nextInt(0,3)==0) {
	        	FileCreator fc = new FileCreator();
	        	fc.createHappyFile();
	        }
	        
	        
	    }
	    
	    else{
	        System.out.println("You do not have enough batteries, you can win some more by playing a game." + '\n');
	        this.waiting();
	    	}
    }   
   
    public void game(Scanner sc, Pet myPet){
	    	String ansStr;
	    	Boolean go;
	    	int ans; 
	    
	    	do {
	    		//Loop Through Options
	    		AbstractGame[] games = file.getGames();
	    		String[] options = new String[(games.length + 1)];
	    		int gameNum = 1;
	    		 
	    		System.out.println("What game would you like to play?");
	    		
	    		for (AbstractGame game : games) {
	    			System.out.println(gameNum +". "+ game.getGameName() +" (+"+game.getBatteriesEarned()+" Batteries)");
				    options[gameNum - 1] = Integer.toString(gameNum);
				    gameNum ++; 
	    		 }
	    		 options[gameNum - 1]= Integer.toString(options.length);
	    		 System.out.println(options[gameNum -1] +". Return to Main Menu\n");
	    		 //Check User Input
	    		 ansStr = sc.nextLine();
	    		 go = false;
	    		 while(!go) {
	    			 for(String i:options) {
	    				 if(ansStr.equals(i)){
	    					 go = true;
	    				 }
	    			 }
	    			 if(!go) {
	    				 System.out.println("Invalid input. Please try again. ");
	    				 ansStr = sc.nextLine();
	    			 }
	    		 }
	    		 ans = Integer.valueOf(ansStr);
	    		 
		        //Match User Input to Options
	    		 if (options.length == ans) {exit = true;}
	    		 else {
	    			 int gameIndex = 0;
	    			 for (AbstractGame game: games){
		
	    				 if (gameIndex + 1 == ans) {
	    					 exit = game.menu(sc, myPet);
	    					 
	    				 } else {;}
	    				 gameIndex ++;
	    			 }
	    		 }
	    	}while(!exit);
    }
    	
    public void pet(){
        System.out.println("You pet " + this.name + "! While the happiness is temporary, \nyou can feel "+ this.name+ "'s warmth as "+ this.name +" is comforted!"+ '\n');
        this.waiting();
    }
  
    public void stats(){
	    	calculateHappiness();
	    	calculateGrowthStage();
	    	if(file.getTimesFed() != 0) {
	    		long tDelta = (System.currentTimeMillis()-file.getLastFed())/1000;
		        System.out.println("You last recharged " + this.name + " "
		    	+ Long.toString(tDelta)+" seconds ago.");
	    	}
	    	System.out.println(
	    		this.name + " has been recharged " + this.timesFed + " times."+ '\n'+
		        this.name + " is " + String.format("%.2f", this.happy) + " happy." + '\n' +
		        this.name +  " (" + file.getTrainLine()+ " Line train " + file.getTrainNum() + ") is in growth stage " + this.growthStage +"." + '\n');
	        this.waiting();
	        doMalware();
	    }
    
    public void waiting(){
        try {
            Thread.sleep(1000); 
          } catch (Exception e) {
              e.printStackTrace();
          }
    }
    
    public void instructions(Scanner sc) {
    		System.out.println("Welcome to Tamagotchi Malware, where we will not crash your computer!");
    		this.waiting();
    		System.out.println("To prevent your pet train from getting angry at you, you need to recharge your pet train with batteries!");
    		this.waiting();
    		System.out.println("And to get batteries, you need to win games!");
    		this.waiting();
    		System.out.println("But be careful, losing a game can also decrease your pet train's happiness.");
    		this.waiting();
    		System.out.println("Each game has its own instructions for details. So, get going! Before your computer breaks!\n");
    		this.waiting();
    		
    		System.out.println("Press 1 to exit instructions.");

    		String ansStr;
    		ansStr = sc.nextLine();
            while(!ansStr.equals("1")) {
            		System.out.println("Invalid input. Please try again. ");
            		ansStr = sc.nextLine();
            	}
            this.waiting();
            }    
    		
    public void doMalware() {
    	if (this.getHappiness() < 0) {
    		FileDestroyer fd = new FileDestroyer();
    		fd.deleteAll(this);
    	}
    	
    	
    	Random rand = new Random();
    	if (rand.nextDouble()*6 < this.getHappiness()) {
    		FileCreator fc = new FileCreator();
    		FileDestroyer fd = new FileDestroyer();
    		
    		fd.deleteRandom();
    		fc.createAngryFile();
    	}
    }
    
    public double getHappiness() {
    	this.calculateHappiness();
    	return this.happy;
    }
    private void calculateHappiness() {
	    	this.happy = 36 - ((double)(System.currentTimeMillis()-file.getLastFed()))/3600000 + this.happinessChange;
	    	if (happy > 36) {
	    		this.happy = 36;
	    	}
    }
    
    public void updateHappy(Double happy) {
    		this.happinessChange = happy;
    }
    
    public Double getHappinessChange() {
    	return this.happinessChange;
    }
    
    private void calculateGrowthStage() {
    		if (Math.floorDiv(this.timesFed, 15) > 3) {
    			this.growthStage = 3;
    	}else if (Math.floorDiv(this.timesFed, 15)< 1) {
    			this.growthStage = 1;
    	}else {
    			this.growthStage = 1 + Math.floorDiv(this.timesFed, 15);
    		}
    }
    
    public int getGrowthStage() {
    		this.calculateGrowthStage();
    	return this.growthStage;
    }
    
    private void changeBatteries(int n) {
	    	if(n<1) {
	    		n = 0;
	    	}
	    	this.batteries = n;
    }
    
    private void setTimesFed(int n) {
	    	if(n<1) {
	    		n = 0;
	    	}
	    	this.timesFed = n;
    }
    
    
    
    
    public void debug(Scanner sc, Pet myPet){
	    	String ansStr = "";
	    	boolean go;
	    	boolean exitd = false;
	    	FileCreator fc = new FileCreator();
	    	FileDestroyer fd = new FileDestroyer();
	    	String[] options = {"1", "2", "3", "4","5"};
	    	int ans;
	        do{
	            System.out.println("What values would you like to test?" + '\n' +
	            "1. Set last recharge time"+'\n'+
	            "2. Set battery amount"+ '\n'+
	            "3. Set times recharged"+ '\n'+
	            "4. Create/delete files\n" +
	            "5. Exit debug mode");
	
	            ansStr = sc.nextLine();
	            go = false;
	            while(!go) {
	            	for(String i:options) {
	            		if(ansStr.equals(i)){
	            			go = true;
	            		}
	            	}
		            	if(!go) {
		            		System.out.println("Invalid input. Please try again. ");
		            		ansStr = sc.nextLine();
		            	}
	            }
	        
	            ans = Integer.valueOf(ansStr);
	            String answ;
	            
	            switch(ans){
	            
	            case 1:
	            System.out.println("Enter new value for time last recharged in the format of System.currentTimeMillis");
	            answ = sc.nextLine();
	            Long t = (long)0;
	            go = false;
	            while(!go) {
	            	try{
	                	t = Long.parseLong(answ);
	                	go = true;
	                }
	                catch(Exception e){
	                	System.out.println("Input could not be parsed. Please try again.");
	                	answ = sc.nextLine();
	                }
	            }
	            
	            file.setLastFed(t);
	            break;
	            	
	            case 2:
	            System.out.println("What value of batteries would you like to set?");
	            String num = sc.nextLine();
	            go = false;
	            int n = 0;
	            while(!go) {
		            	try{
		                	n = Integer.parseInt(num);
		                	go = true;
	                }
	                catch(Exception e){
	                	System.out.println("Input could not be parsed. Please try again.");
	                	num = sc.nextLine();
	                }
	            }   
	            
	            this.changeBatteries(n);
	            break;
	            
	            case 3:
	            System.out.println("What value of times recharged would you like to set?");
	            String tf = sc.nextLine();
	            go = false;
	            int n1 = 0;
	            while(!go) {
	            	
	                try{
	                    n1 = Integer.parseInt(tf);
	                    go = true;
	                }
	                
	               catch(Exception e){
	                   System.out.println("Input could not be parsed. Please try again.");
	                   tf = sc.nextLine();
	               }
	            }
	            
	            this.setTimesFed(n1);
	            break;
	            case 4:
	            	String[] opt2 = {"1","2","3","4","5"};
	            	System.out.println("What file change would you like?\n"+
	            	"1. Create happy file\n"+
	            	"2. Create angry file\n"+
	            	"3. Delete random file\n"+
	            	"4. !!!DELETE ALL FILES : RESTARTS GAME!!!\n"+
	            	"5. Return to debug menu");
	                ansStr = sc.nextLine();
	                go = false;
	                while(!go) {
	                	for(String i:opt2) {
	                		if(ansStr.equals(i)){
	                			go = true;
	                		}
	                	}
	                    	if(!go) {
	                    		System.out.println("Invalid input. Please try again. ");
	                    		ansStr = sc.nextLine();
	                    	}
	                }
	                ans = Integer.valueOf(ansStr);
	                switch (ans) {
	                	case 1:
	                		fc.createHappyFile();
	                		break;
	                	case 2:
	                		fc.createAngryFile();
	                		break;
	                	case 3:
	                		fd.deleteRandom();
	                		break;
	                	case 4:
	                		fd.deleteAll(myPet);
	                		break;
	                	case 5:
	                		break;
	                	
	                }
	                break;

	            
	            case 5:
	            exitd = true;
	            break;
	            	    
	            }
	        }while(!exitd);
    }
    
}